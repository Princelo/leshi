<div id="mobile_cart_list">
    <style>
        .mobile_deal_cart_row {width: 100%; position: relative; height: 68px; float:left; padding-bottom: 12px; padding-top:12px; border-bottom: 1px solid #ddd;}
        .mobile_deal_cart_row > div {float:left;}
        .mobile-deal-buy-desc {width: 60px; margin-left: 10px;}
        .mobile-deal-buy-desc .cart-icon img{width: 50px;}
        .mobile-deal-buy-desc .cart-title>a{text-overflow: ellipsis; width: 50px; height: 18px;
            line-height:18px; display:block; overflow: hidden}
        .mobile-cart-number { width: 100px; height: 53px; padding-top: 15px;}
        .mobile-cart-number input {padding:1}
        .mobile-deal-buy-price {width: 100px; height: 34px;
            line-height:34px;}
        .mobile-deal-buy-total {width: 100px; height: 34px;
            line-height:34px;}
        .mobile-deal-buy-del {position: absolute;right: 12px; bottom: 30px;}
        .yhd_layout_footer {
            position: fixed;
            width: 100%;
            height: 55px;
            overflow: hidden;
            border-top: 1px solid #e0e0e0;
            bottom:0;
            background:#fff;
        }
        .yhd_layout_footer .ab-left {position: absolute; left: 12px; font-size: 1em; width: 50px; height: 28px;
            line-height:28px; top: 12px;}
        .yhd_layout_footer .ab-left span { font-size: 16px; width: 50px; height: 28px; line-height: 28px;
            text-align: center;}
        .mobile_cart_warn {border: 1px solid #ff2f00;}
        .yhd_layout_footer .ab-right {position: absolute; right:0;}
        .yhd_layout_footer .ab-right span {
            display: block;
            width: 90px;
            height: 100%;
            line-height: 55px;
            text-align: center;
            background-color: #ff3c25;
            color: #fff;
            font-size: 1.6rem;
        }
        .yhd_layout_footer .ab-text {
            line-height: 55px;
            font-size: 1em;
            padding-left: 80px;
        }
    </style>
    <script src="/js/ios-prompt.js"></script>
    <script>
        $(document).ready(function(){
            $('.footer').hide();
        })
    </script>
        {foreach from=$cart_list item=cart_item}
        <li class="deal_{$cart_item.deal_id} mobile_deal_cart_row" rel="cart_{$cart_item.deal_id}_{$cart_item.attr_str}">
            <div class="mobile-deal-buy-desc">
                <div class="cart-icon f_l">
                    <a id="cartTitle" href="{url x="shop" r="goods" p="id=$cart_item.deal_id"}" target="_blank" title="{$cart_item.name}">
                    <img src="{function name="get_spec_image" v=$cart_item.icon w=100 h=100 g=1}" alt="{$cart_item.name}" />
                    </a>
                </div>
                <div class="cart-title f_l">
                    <a href="{url x="shop" r="goods" p="id=$cart_item.deal_id"}" target="_blank" title="{$cart_item.name}">{function name="msubstr" v=$cart_item.name b=0 e=50}
                    </a>
                </div>
            </div>

            <!--<input type="text" style="ime-mode: disabled;" onblur="modify_cart({$cart_item.id},this);" id="deal-buy-quantity-input" value="{$cart_item.number}" name="quantity" maxlength="4" class="input-text f-input" buy_type="{$cart_item.buy_type}">-->
            <div class="pd_product-num-wrap mobile-cart-number">
                <span class="pd_product-num-minus pd_product-num_disable" data-tpa="H5_DETAIL_AMOUNTSELECT" data-trackersend="1" onclick="minus({$cart_item.id})"></span>
                <input class="pd_product-num-form" type="number" min="1" max="999" value="{$cart_item.number}" id="buy_number{$cart_item.id}" required="" name="quantity" buy_type="{$cart_item.buy_type}">
                <span class="pd_product-num-plus" data-tpa="H5_DETAIL_AMOUNTSELECT" data-trackersend="1" onclick="plus({$cart_item.id})"></span>
            </div>
            <div>
                <div class="mobile-deal-buy-price" id="money_single">
                    单价: <span style="color:#ff2f00">{if $cart_item.buy_type neq 1}
                    {function name="format_price" value=$cart_item.unit_price}
                    {else}
                    <?php echo format_score(abs($this->_var['cart_item']['price_score']));?>
                    {/if}
                    </span>
                </div>

                <div class="mobile-deal-buy-total" id="money_total">
                    合计: <span style="color:#ff2f00">{if $cart_item.buy_type neq 1}
                    {function name="format_price" value=$cart_item.total_price}
                    {else}
                    <?php echo format_score(abs($this->_var['cart_item']['price_total_score']));?>
                    {/if}
                    </span>
                </div>
            </div>

            <?PHP if(app_conf("CART_ON")==1){ ?>
            <div class="mobile-deal-buy-del"><a class="pd_product-price-tag" onclick="mobile_del_cart({$cart_item.id})" href="javascript:void(0);">{$LANG.DELETE}</a></div>
            <?PHP  }?>
        </li>
        {/foreach}


    <div class="yhd_layout_footer">
        <div style="position:relative">
            <div class="ab-left">
                <span class="pd_product-price-tag" onclick="mobile_clear_cart()">清空</span>
            </div>
            <div class="ab-right">
                <span class="yhd_confirm" onclick="mobile_submit_cart()">结算</span>
            </div>
            <div class="ab-text">{$LANG.PAY_TOTAL_PRICE_NO_DELIVERY}<span style="color:#ff2f00">{function name="format_price" value=$total_price} {$total_score}</span></div>
        </div>
    </div>
</div><!--end cart_list-->
<script>
    function mobile_modify_cart(id,htmlobj)
    {
        var number = $(htmlobj).val();
        if ($(htmlobj).attr('buy_type') == '0')
            var ajaxurl = "/shop.php?ctl=cart&act=modifycart&id="+id+"&number="+number;
        else if ($(htmlobj).attr('buy_type') == '1')
            var ajaxurl = "/shop.php?ctl=cart&act=scoremodifycart&id="+id+"&number="+number;
        $.ajax({
            url: ajaxurl,
            dataType: "json",
            success: function(obj){
                if(obj.status == 1)
                {
                    $("#mobile_cart_list").html(obj.html);
                }
                else
                {
                    var str = obj.info.split("|");
                    var msg = str[0];
                    $.showErr(msg);
                    $(".deal_cart_row").removeClass("cart_warn");
                    if(str[2])
                        $("li[rel*='cart_"+str[1]+"_"+str[2]+"']").addClass("cart_warn");
                    else
                        $(".deal_"+str[1]).addClass("cart_warn");
                }
            },
            error:function(ajaxobj)
            {
//			if(ajaxobj.responseText!='')
//			alert(ajaxobj.responseText);
            }
        });
    }
    function mobile_del_cart(id)
    {
        var ajaxurl = "/shop.php?ctl=cart&act=delcart&id="+id;
        $.ajax({
            url: ajaxurl,
            dataType: "json",
            success: function(obj){
                location.href = '';
                /*if(obj.status == 1)
                 {
                 $("#cart_list").html(obj.html);
                 }
                 else
                 {
                 location.href = CART_URL;
                 }*/
            },
            error:function(ajaxobj)
            {
//			if(ajaxobj.responseText!='')
//			alert(ajaxobj.responseText);
            }
        });
    }
    function mobile_clear_cart()
    {
        var ajaxurl = "/shop.php?ctl=cart&act=clear_cart";

        $.ajax({
            url: ajaxurl,
            success: function(obj){
                location.href= location.href;
            },
            error:function(ajaxobj)
            {
//						if(ajaxobj.responseText!='')
//						alert(ajaxobj.responseText);
            }
        });
    }
    function mobile_submit_cart()
    {
        var verify_code = $("input[name='verify_code']").val();
        var mobile = $("input[name='lottery_mobile']").val();
        var ajaxurl = "/shop.php?ctl=cart&act=check&ajax=1&verify="+verify_code+"&mobile="+mobile;

        $.ajax({
            url: ajaxurl,
            dataType: "json",
            success: function(obj){
                if(obj.status == 1)
                {
                    location.href = '{url x="shop" r="cart#check"}';
                }
                else
                {
                    if(obj.open_win == 1)
                    {
                        alert({
                            content: '你还未登录',
                            boxClass: "custom-alert"
                        }, function () {
                            window.location.href = '{url x="shop" r="user#login"}';
                        });
                    }
                    else
                    {
                        var str = obj.info.split("|");
                        var msg = str[0];
                        alert(msg);
                        $(".mobile_deal_cart_row").removeClass("mobile_cart_warn");
                        if(str[2])
                            $("li[rel*='cart_"+str[1]+"_"+str[2]+"']").addClass("mobile_cart_warn");
                        else
                            $(".deal_"+str[1]).addClass("mobile_cart_warn");
                    }
                }
            },
            error:function(ajaxobj)
            {
//			if(ajaxobj.responseText!='')
//			alert(ajaxobj.responseText);
            }
        });
    }
    var minus = function (id) {
        if (parseInt($('#buy_number'+id).val())>1) {
            $('#buy_number'+id).val(parseInt($('#buy_number'+id).val()) - 1)
            mobile_modify_cart(id, '#buy_number'+id);
        }
    }
    var plus = function (id) {
        $('#buy_number'+id).val(parseInt($('#buy_number'+id).val()) + 1)
        mobile_modify_cart(id, '#buy_number'+id);
    }
</script>